<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>prct12</title><meta name="description" content="Documentation for prct12"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">prct12</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>prct12</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#práctica-12---destravate" id="práctica-12---destravate" style="color: inherit; text-decoration: none;">
  <h1>Práctica 12 - Destravate</h1>
</a>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/node.js.yml/badge.svg" alt="Node.js CI"></a> <a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/coveralls.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/coveralls.yml/badge.svg" alt="Coveralls"></a> <a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/sonarcloud.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/sonarcloud.yml/badge.svg" alt="Sonar-Cloud"></a> <a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/pages/pages-build-deployment"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupa/actions/workflows/pages/pages-build-deployment/badge.svg" alt="pages-build-deployment"></a></p>

<a href="#introducción" id="introducción" style="color: inherit; text-decoration: none;">
  <h2>Introducción</h2>
</a>
<p>El objetivo de esta práctica es implementar un API REST, haciendo uso de Node/Express, que permita llevar a cabo operaciones de creación, lectura, modificación y borrado <a href="https://developer.mozilla.org/es/docs/Glossary/CRUD">(Create, Read, Update, Delete - CRUD)</a> de un registro de actividades deportivas.</p>
<p>La aplicación estará conformada por usuarios que se podrán registrar en la base de datos, grupos formados por usuarios, rutas deportivas y retos a realizar.</p>
<p>Todas las entradas serán guardadas en una base de datos <a href="https://www.mongodb.com/">MongoDB</a>, haciendo uso de Modelado de Datos con Mongoose. Por último, la API será desplegada en <a href="https://www.cyclic.sh/">Cyclic</a>.</p>

<a href="#planteamiento" id="planteamiento" style="color: inherit; text-decoration: none;">
  <h2>Planteamiento</h2>
</a>
<p>Para el diseño de nuestra jerarquía de estructuras de datos empezamos definiendo una clase para cada tipo de objeto a almacenar en la base de datos, resultando en las clases:</p>
<ul>
<li><code>User</code></li>
<li><code>Group</code></li>
<li><code>Track</code></li>
<li><code>Challenge</code></li>
</ul>
<p>Realmente no era necesario realizar estas clases ya que al ser una API REST, los datos se almacenan en la base de datos y se devuelven en formato JSON (realmente sólo interesa la interfaz que conforman a cada una de ellas), pero se ha decidido realizarlas para poder realizar las operaciones de validación de datos y de comprobación de unicidad de los mismos, en vista a un posible desarrollo de una aplicación por consola que haga uso de la API.</p>
<p>Para funcionar, las clases necesitan de otras estructuras de apoyo, como por ejemplo la definición de las coordenadas que definen un punto de una ruta deportiva, las listas con los distintos identificadores... Al final, estas estructuras son:</p>
<ul>
<li><code>Activity</code>. Define una enumeración con los distintos tipos de actividad deportiva permitidos.</li>
<li><code>Coordinate</code>. Define un tipo de objeto que representa una coordenada geográfica.</li>
<li><code>Entry</code>. Define un tipo de objeto que representa una entrada en la base de datos.</li>
<li><code>Stats</code>. Define una clase que representa las estadísticas de una ruta deportiva.</li>
<li><code>UniqueList</code>. Define una clase que representa una lista de elementos únicos.</li>
</ul>
<p>Por último, para poder gestionar tanto la base de datos como las solicitudes realizadas a la API, se ha definido la clase <code>Server</code>, que se encarga de gestionar las peticiones HTTP y de realizar las operaciones necesarias en la base de datos. Para ello, se ha hecho uso de la librería <a href="https://expressjs.com/">Express</a>.</p>
<p><img src="./images/express.png" alt="Express"></p>
<p>Además, este servidor creará, consultará, eliminará y modificará los datos de la base de datos haciendo uso de la librería <a href="https://mongoosejs.com/">Mongoose</a> y de los modelos definidos en el fichero <code>Model</code>.</p>
<p><img src="./images/mongodb.png" alt="MongoDB"></p>

<a href="#desarrollo" id="desarrollo" style="color: inherit; text-decoration: none;">
  <h2>Desarrollo</h2>
</a>
<p>En el siguiente apartado profundizaremos más en los ficheros que conforman la API, explicando su funcionamiento y su estructura.</p>

<a href="#activityts" id="activityts" style="color: inherit; text-decoration: none;">
  <h3>Activity.ts</h3>
</a>
<p>Aquí se encuentra la definición del enumerado <code>Activity</code>, que contiene los distintos tipos de actividad deportiva que los usuarios pueden realizar.</p>
<p>Se ha optado por escoger este tipo de estructura para poder controlar mejor los valores introducidos como actividad, evitando entradas ilógicas como por ejemplo <code>universidad</code> o <code>dormir</code>.</p>
<pre><code class="language-TypeScript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">enum</span><span class="hl-1"> </span><span class="hl-3">Activity</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">running</span><span class="hl-1"> = </span><span class="hl-5">&#39;running&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">cycling</span><span class="hl-1"> = </span><span class="hl-5">&#39;cycling&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">hiking</span><span class="hl-1"> = </span><span class="hl-5">&#39;hiking&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#coordinatets" id="coordinatets" style="color: inherit; text-decoration: none;">
  <h3>Coordinate.ts</h3>
</a>
<p>Este fichero define un tipo de dato llamado <code>Coordinate</code> que representa una coordenada geográfica. El tipo de dato tiene dos propiedades: <code>lat</code> y <code>lng</code>, que representan la latitud y longitud de la coordenada, respectivamente.</p>
<p>Se utilizará este tipo de dato para representar los puntos de una ruta deportiva en los objetos de tipo <code>Track</code>.</p>
<pre><code class="language-TypeScript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Coordinate</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-6">lat</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-6">lng</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#uniquelistts" id="uniquelistts" style="color: inherit; text-decoration: none;">
  <h3>UniqueList.ts</h3>
</a>
<p>El siguiente fichero define la clase <code>UniqueList</code>, que se trata de una ampliación de la clase <code>Array</code> de JavaScript. Esta clase permite almacenar elementos únicos, evitando que se puedan almacenar elementos duplicados.</p>
<p>Esta estructura la creamos para poder garantizar que los datos almacenados en la base de datos no contengan elementos duplicados, como por ejemplo, que un usuario esté dos veces en un grupo.</p>
<pre><code class="language-TypeScript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">constructor</span><span class="hl-1">(...</span><span class="hl-6">values</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">[]) {</span><br/><span class="hl-1">    </span><span class="hl-2">super</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">values</span><span class="hl-1">) </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">add</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-7">has</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">): </span><span class="hl-3">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">v</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-2">this</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">JSON</span><span class="hl-1">.</span><span class="hl-7">stringify</span><span class="hl-1">(</span><span class="hl-6">v</span><span class="hl-1">) === </span><span class="hl-4">JSON</span><span class="hl-1">.</span><span class="hl-7">stringify</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">)) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">false</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-7">add</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">): </span><span class="hl-3">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">has</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">)) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">false</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">push</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-7">remove</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">): </span><span class="hl-3">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">has</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">)) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">false</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">), </span><span class="hl-8">1</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#entryts" id="entryts" style="color: inherit; text-decoration: none;">
  <h3>Entry.ts</h3>
</a>
<p>Este fichero define dos tipos de datos: <code>Entry</code> y <code>ExtendedEntry</code>. Estas estructuras se utilizan para guardar registros en la base de datos, en concreto para guardar las entradas de las rutas realizadas por usuarios y para el historial de los grupos.</p>
<p>Las clases se han implementado usando plantillas de TypeScript, de forma que se puedan utilizar con distintos tipos de datos. Esto es para poder utilizar distintos tipos de identificadores para los usuarios y las rutas deportivas.</p>
<p>El tipo <code>ExtendedEntry</code> es una extensión del tipo <code>Entry</code> que añade dos propiedades: <code>users</code> y <code>km</code>. La propiedad <code>users</code> es una lista de usuarios que han realizado la ruta deportiva y la propiedad <code>km</code> es un número que representa la distancia total de la ruta deportiva. Este tipo es el que se utilizará en los grupos</p>
<pre><code class="language-TypeScript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">UniqueList</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./UniqueList&#39;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Entry</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-6">date</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-6">tracks</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">ExtendedEntry</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; = </span><span class="hl-3">Entry</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; &amp; {</span><br/><span class="hl-1">  </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">km</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#statsts" id="statsts" style="color: inherit; text-decoration: none;">
  <h3>Stats.ts</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Stat</span><span class="hl-1"> = {</span><br/><br/><span class="hl-1">  </span><span class="hl-6">km</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><br/><span class="hl-1">  </span><span class="hl-6">slope</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">Stats</span><span class="hl-1"> {</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">values</span><span class="hl-1">: { [</span><span class="hl-6">key</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">]: </span><span class="hl-3">Stat</span><span class="hl-1"> }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">values</span><span class="hl-1"> = {}</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-7">reset</span><span class="hl-1">(): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">key</span><span class="hl-1"> </span><span class="hl-2">in</span><span class="hl-1"> </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">values</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">values</span><span class="hl-1">[</span><span class="hl-6">key</span><span class="hl-1">].</span><span class="hl-6">km</span><span class="hl-1"> = </span><span class="hl-8">0</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">values</span><span class="hl-1">[</span><span class="hl-6">key</span><span class="hl-1">].</span><span class="hl-6">slope</span><span class="hl-1"> = </span><span class="hl-8">0</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Este código define una interfaz <code>Stat</code> y una clase <code>Stats</code>.</p>
<p>La interfaz <code>Stat</code> define un objeto que tiene dos propiedades: <code>km</code> y <code>slope</code>, ambas de tipo número.</p>
<p>La clase <code>Stats</code> tiene una propiedad pública llamada <code>values</code> que es un objeto que tiene claves de tipo string y valores de tipo <code>Stat</code>. El constructor de la clase inicializa la propiedad <code>values</code> como un objeto vacío.</p>
<p>La clase <code>Stats</code> también tiene un método público llamado <code>reset()</code> que no devuelve nada (void). Este método itera sobre todas las claves del objeto <code>values</code> y establece los valores de <code>km</code> y <code>slope</code> en cero.</p>

<a href="#trackts" id="trackts" style="color: inherit; text-decoration: none;">
  <h3>Track.ts</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Coordinate</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Coordinate.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Activity</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Activity.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">UniqueList</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./UniqueList.js&#39;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">TrackInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-6">start</span><span class="hl-1">: </span><span class="hl-3">Coordinate</span><br/><span class="hl-1">  </span><span class="hl-6">end</span><span class="hl-1">: </span><span class="hl-3">Coordinate</span><br/><span class="hl-1">  </span><span class="hl-6">distance</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-6">slope</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><br/><span class="hl-1">  </span><span class="hl-6">score</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">Track</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; </span><span class="hl-2">implements</span><span class="hl-1"> </span><span class="hl-3">TrackInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">readonly</span><span class="hl-1"> </span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">start</span><span class="hl-1">: </span><span class="hl-3">Coordinate</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">end</span><span class="hl-1">: </span><span class="hl-3">Coordinate</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">distance</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">slope</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">score</span><span class="hl-1"> = </span><span class="hl-8">0</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">constructor</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">start</span><span class="hl-1">: </span><span class="hl-3">Coordinate</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">end</span><span class="hl-1">: </span><span class="hl-3">Coordinate</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">distance</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">slope</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><br/><span class="hl-1">  ) {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1"> = </span><span class="hl-6">id</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1"> = </span><span class="hl-6">name</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">start</span><span class="hl-1"> = </span><span class="hl-6">start</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">end</span><span class="hl-1"> = </span><span class="hl-6">end</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">distance</span><span class="hl-1"> = </span><span class="hl-6">distance</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">slope</span><span class="hl-1"> = </span><span class="hl-6">slope</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">activity</span><span class="hl-1"> = </span><span class="hl-6">activity</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Este código define una interfaz <code>TrackInterface</code> y una clase <code>Track</code>.</p>
<p>La interfaz <code>TrackInterface</code> define un objeto que tiene varias propiedades, incluyendo <code>name</code>, <code>start</code>, <code>end</code>, <code>distance</code>, <code>slope</code>, <code>users</code>, <code>activity</code> y <code>score</code>. Algunas de estas propiedades tienen tipos genéricos, lo que significa que pueden ser de cualquier tipo.</p>
<p>La clase <code>Track</code> implementa la interfaz <code>TrackInterface</code> y tiene varias propiedades públicas, incluyendo <code>id</code>, <code>name</code>, <code>start</code>, <code>end</code>, <code>distance</code>, <code>slope</code>, <code>users</code>, <code>activity</code> y <code>score</code>. La propiedad <code>id</code> es de solo lectura y se establece en el constructor. Las propiedades <code>name</code>, <code>start</code>, <code>end</code>, <code>distance</code>, <code>slope</code> y <code>activity</code> se establecen en el constructor y se pueden modificar posteriormente. La propiedad <code>users</code> es una instancia de la clase <code>UniqueList</code>, que es una lista que solo permite valores únicos.</p>
<p>La clase <code>Track</code> también tiene un constructor que toma varios argumentos, incluyendo <code>id</code>, <code>name</code>, <code>start</code>, <code>end</code>, <code>distance</code>, <code>slope</code> y <code>activity</code>. Este constructor inicializa las propiedades correspondientes con los valores proporcionados.</p>

<a href="#userts" id="userts" style="color: inherit; text-decoration: none;">
  <h3>User.ts</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Activity</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Activity.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Stats</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Stats.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">UniqueList</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./UniqueList.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Entry</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Entry.js&#39;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">UserInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><br/><span class="hl-1">  </span><span class="hl-6">stats</span><span class="hl-1">: </span><span class="hl-3">Stats</span><br/><span class="hl-1">  </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-6">groups</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-6">tracks</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-6">challenges</span><span class="hl-1">: </span><span class="hl-3">T</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-6">records</span><span class="hl-1">: </span><span class="hl-3">Entry</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;[]</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">User</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; </span><span class="hl-2">implements</span><span class="hl-1"> </span><span class="hl-3">UserInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">readonly</span><span class="hl-1"> </span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">groups</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">stats</span><span class="hl-1">: </span><span class="hl-3">Stats</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Stats</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">tracks</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">challenges</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">records</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">Entry</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">Entry</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;&gt;()</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">, </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">, </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1"> = </span><span class="hl-6">id</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1"> = </span><span class="hl-6">name</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">activity</span><span class="hl-1"> = </span><span class="hl-6">activity</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">stats</span><span class="hl-1">.</span><span class="hl-6">values</span><span class="hl-1"> = {</span><br/><span class="hl-1">      </span><span class="hl-6">weekly:</span><span class="hl-1"> { </span><span class="hl-6">km:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-6">slope:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-6">monthly:</span><span class="hl-1"> { </span><span class="hl-6">km:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-6">slope:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-6">yearly:</span><span class="hl-1"> { </span><span class="hl-6">km:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-6">slope:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1"> },</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Este código define una interfaz <code>UserInterface</code> y una clase <code>User</code>.</p>
<p>La interfaz <code>UserInterface</code> define un objeto que tiene varias propiedades, incluyendo <code>name</code>, <code>activity</code>, <code>stats</code>, <code>users</code>, <code>groups</code>, <code>tracks</code>, <code>challenges</code> y <code>records</code>. Algunas de estas propiedades tienen tipos genéricos, lo que significa que pueden ser de cualquier tipo.</p>
<p>La clase <code>User</code> implementa la interfaz <code>UserInterface</code> y tiene varias propiedades públicas, incluyendo <code>id</code>, <code>name</code>, <code>activity</code>, <code>users</code>, <code>groups</code>, <code>stats</code>, <code>tracks</code>, <code>challenges</code> y <code>records</code>. Las propiedades <code>id</code>, <code>name</code> y <code>activity</code> se establecen en el constructor y se pueden modificar posteriormente. Las propiedades <code>users</code>, <code>groups</code>, <code>tracks</code>, <code>challenges</code> y <code>records</code> son instancias de la clase <code>UniqueList</code>, que es una lista que solo permite valores únicos. La propiedad <code>stats</code> es una instancia de la clase <code>Stats</code>, que se utiliza para almacenar estadísticas de actividad física.</p>
<p>El constructor de la clase <code>User</code> toma tres argumentos: <code>id</code>, <code>name</code> y <code>activity</code>. Este constructor inicializa las propiedades correspondientes con los valores proporcionados. También inicializa la propiedad <code>stats</code> con valores predeterminados para las estadísticas semanales, mensuales y anuales.</p>

<a href="#challengets" id="challengets" style="color: inherit; text-decoration: none;">
  <h3>Challenge.ts</h3>
</a>
<p>Este fichero contiene una definición de la clase <code>Challenge</code> que implementa una interfaz llamada <code>ChallengeInterface</code>.</p>
<p>La propiedad <code>id</code> es de solo lectura y se establece en el constructor. La propiedad <code>name</code> es una cadena que representa el nombre del desafío. La propiedad <code>activity</code> es un objeto de la clase <code>Activity</code> que representa la actividad asociada con el desafío. Las propiedades <code>tracks</code> y <code>users</code> son listas de tipo genérico <code>T</code> que se implementan como objetos de la clase <code>UniqueList</code>.</p>
<pre><code class="language-TypeScript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Activity</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Activity.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">UniqueList</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./UniqueList.js&#39;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">ChallengeInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><br/><span class="hl-1">  </span><span class="hl-6">tracks</span><span class="hl-1">: </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">Challenge</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; </span><span class="hl-2">implements</span><span class="hl-1"> </span><span class="hl-3">ChallengeInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">readonly</span><span class="hl-1"> </span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">tracks</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">, </span><span class="hl-6">name</span><span class="hl-1">, </span><span class="hl-6">activity</span><span class="hl-1">, ...</span><span class="hl-6">tracks</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1"> = </span><span class="hl-6">id</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1"> = </span><span class="hl-6">name</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">activity</span><span class="hl-1"> = </span><span class="hl-6">activity</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">track</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">tracks</span><span class="hl-1">) </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">tracks</span><span class="hl-1">.</span><span class="hl-7">add</span><span class="hl-1">(</span><span class="hl-6">track</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#groupts" id="groupts" style="color: inherit; text-decoration: none;">
  <h3>Group.ts</h3>
</a>
<p>Este fichero define la clase <code>Group</code> que implementa la interfaz <code>GroupInterface</code>. La interfaz <code>GroupInterface</code> define una estructura de datos que representa un grupo de usuarios y sus estadísticas de actividad física. Posee propiedades como <code>name</code>, <code>users</code>, <code>stats</code>, <code>tracks</code>, <code>records</code> y <code>ranking</code>, que representan el nombre del grupo, la lista de usuarios, las estadísticas de actividad física, las pistas, los registros y la clasificación de los usuarios en función de su actividad física.</p>
<p>En pos de la simplicidad, a continuación mostramos la <strong>interfaz</strong> de la clase aparte de los <strong>métodos de clase</strong>, no profundizamos en el constructor y los atributos de la clase ya que siguen la misma estructura de la interfaz.</p>
<pre><code class="language-TypeScript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Stats</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Stats.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">UniqueList</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./UniqueList.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">ExtendedEntry</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Entry.js&#39;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">GroupInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">  </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">stats</span><span class="hl-1">: </span><span class="hl-3">Stats</span><br/><span class="hl-1">  </span><span class="hl-6">ranking</span><span class="hl-1">: </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">tracks</span><span class="hl-1">: </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">records</span><span class="hl-1">: </span><span class="hl-3">Array</span><span class="hl-1">&lt;</span><span class="hl-3">ExtendedEntry</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;&gt;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">Group</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1"> = </span><span class="hl-3">number</span><span class="hl-1">&gt; </span><span class="hl-2">implements</span><span class="hl-1"> </span><span class="hl-3">GroupInterface</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">get</span><span class="hl-1"> </span><span class="hl-7">ranking</span><span class="hl-1">(): </span><span class="hl-3">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">ranking</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">distances</span><span class="hl-1">: { [</span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">]: </span><span class="hl-3">number</span><span class="hl-1"> } = {}</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">record</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">records</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">record</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">distances</span><span class="hl-1">[</span><span class="hl-7">String</span><span class="hl-1">(</span><span class="hl-6">user</span><span class="hl-1">)]) </span><span class="hl-6">distances</span><span class="hl-1">[</span><span class="hl-7">String</span><span class="hl-1">(</span><span class="hl-6">user</span><span class="hl-1">)] += </span><span class="hl-6">record</span><span class="hl-1">.</span><span class="hl-6">km</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">distances</span><span class="hl-1">[</span><span class="hl-7">String</span><span class="hl-1">(</span><span class="hl-6">user</span><span class="hl-1">)] = </span><span class="hl-6">record</span><span class="hl-1">.</span><span class="hl-6">km</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">sorted</span><span class="hl-1"> = </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-6">distances</span><span class="hl-1">).</span><span class="hl-7">sort</span><span class="hl-1">(</span><br/><span class="hl-1">      (</span><span class="hl-6">a</span><span class="hl-1">, </span><span class="hl-6">b</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-6">distances</span><span class="hl-1">[</span><span class="hl-6">b</span><span class="hl-1">] - </span><span class="hl-6">distances</span><span class="hl-1">[</span><span class="hl-6">a</span><span class="hl-1">]</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">id</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">sorted</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">convertToT</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">) &amp;&amp; </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">has</span><span class="hl-1">(</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">convertToT</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">) </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">T</span><span class="hl-1">))</span><br/><span class="hl-1">        </span><span class="hl-6">ranking</span><span class="hl-1">.</span><span class="hl-7">add</span><span class="hl-1">(</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">convertToT</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">) </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">T</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">ranking</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-7">convertToT</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">: </span><span class="hl-3">any</span><span class="hl-1">): </span><span class="hl-3">T</span><span class="hl-1"> | </span><span class="hl-3">null</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><br/><span class="hl-1">      </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">value</span><span class="hl-1"> === </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">      </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-7">Number</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">) === </span><span class="hl-5">&#39;number&#39;</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">      !</span><span class="hl-7">isNaN</span><span class="hl-1">(</span><span class="hl-7">Number</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">))</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-7">Number</span><span class="hl-1">(</span><span class="hl-6">value</span><span class="hl-1">) </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">T</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">null</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Como pueden observar, se han implementado dos métodos: el método <code>get ranking</code> se encarga de calcular el ranking de los usuarios en el grupo en función de los kilometros realizados por cada uno, sacando dicha información de los registros del grupo (se entiende que los miembros pueden participar o no en una salida del grupo); y el método <code>convertToT</code> se encarga de convertir un valor de tipo <code>any</code> a un valor de tipo <code>T</code> o <code>null</code> si no es posible. Este último se ha desarrollado para que la clase pueda trabajar con cualquier tipo de datos sin ningún problema.</p>

<a href="#modelsts" id="modelsts" style="color: inherit; text-decoration: none;">
  <h3>Models.ts</h3>
</a>
<p>Aquí definiremos los modelos de Mongoose utilizados en el API. Cómo mencionamos realmente estos modelos son los que nos interesan para definir la estructura de datos.</p>
<p>Cada esquema de los modelos se ha implementado utilizando las mismas interfaces que se han definido en los ficheros anteriores.</p>
<p>Para crear el modelo correspondiente utilizando la función <code>model</code> de Mongoose. Por ejemplo, el modelo Track se crea utilizando <code>TrackModel = model&lt;TrackInterface&lt;string&gt;&gt;(&#39;Track&#39;, TrackSchema)</code>.</p>
<p>Cabe destacar que optamos por usar el nombre de cada entidad como único de manera que, por ejemplo, no puede haber dos usuarios con el mismo nombre.</p>
<p>Asimismo, se puede observar que en nungún momento se ha implementado un atributo <code>id</code> (aspecto que en las clases si se ha desarrollado). ¿Por qué? Sencillo, el objetivo de este campo ya lo proporciona la propiedad <code>_id</code> de los documentos de MongoDB. Por esta razón se han desarrollado todas las estructuras con plantillas.</p>
<pre><code class="language-TypeScript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">TrackSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">TrackInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">start:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">end:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">distance:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">slope:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">users:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">activity:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">enum:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-7">values</span><span class="hl-1">(</span><span class="hl-6">Activity</span><span class="hl-1">),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">score:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">TrackModel</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">TrackInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;(</span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">, </span><span class="hl-6">TrackSchema</span><span class="hl-1">)</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">UserSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">UserInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">activity:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">enum:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-7">values</span><span class="hl-1">(</span><span class="hl-6">Activity</span><span class="hl-1">),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">users:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">groups:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Group&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">stats:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Array</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">tracks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">challenges:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Challenge&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">records:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">UserModel</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">UserInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;(</span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">, </span><span class="hl-6">UserSchema</span><span class="hl-1">)</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">GroupSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">GroupInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">users:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">stats:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Array</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">ranking:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">tracks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">records:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">GroupModel</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">GroupInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;(</span><span class="hl-5">&#39;Group&#39;</span><span class="hl-1">, </span><span class="hl-6">GroupSchema</span><span class="hl-1">)</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">ChallengeSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">ChallengeInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">activity:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">enum:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-7">values</span><span class="hl-1">(</span><span class="hl-6">Activity</span><span class="hl-1">),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">tracks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">users:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">Mixed</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">ChallengeModel</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">ChallengeInterface</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;&gt;(</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;Challenge&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">ChallengeSchema</span><br/><span class="hl-1">)</span>
</code></pre>

<a href="#serverts" id="serverts" style="color: inherit; text-decoration: none;">
  <h3>Server.ts</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-6">express</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;express&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Server</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">HttpServer</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;http&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">connect</span><span class="hl-1">, </span><span class="hl-6">disconnect</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;mongoose&#39;</span><br/><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Group</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Group.js&#39;</span><br/><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">UniqueList</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./UniqueList.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">ExtendedEntry</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Entry.js&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">TrackModel</span><span class="hl-1">, </span><span class="hl-6">UserModel</span><span class="hl-1">, </span><span class="hl-6">GroupModel</span><span class="hl-1">, </span><span class="hl-6">ChallengeModel</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Models.js&#39;</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">routes</span><span class="hl-1"> = [</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/tracks/:id&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/users/:id&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/groups/:id&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&#39;/challenges/:id&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">]</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">Server</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-6">server</span><span class="hl-1">: </span><span class="hl-3">HttpServer</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">HttpServer</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Application</span><span class="hl-1"> = </span><span class="hl-7">express</span><span class="hl-1">()</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-6">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">())</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">defineGet</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">definePost</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">defineDelete</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">definePatch</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">app</span><span class="hl-1">.</span><span class="hl-7">all</span><span class="hl-1">(</span><span class="hl-5">&#39;*&#39;</span><span class="hl-1">, (</span><span class="hl-6">_</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">501</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">()</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>En primera instancia, además de añadir las importaciones necesarias, se define una constante llamada <code>routes</code> que contiene las rutas que se utilizarán en el servidor: <code>/tracks</code>, <code>/users</code>, <code>/groups</code> y <code>/challenges</code>. Notese como también se han añadido las rutas con <code>/:id</code> para poder hacer peticiones a un recurso concreto (por ejemplo, <code>/tracks/1</code>)</p>
<p>Se inicializa el atributo <code>server</code> que almacenará el servidor HTTP y el atributo <code>app</code> que almacenará la aplicación Express. Se define el constructor de la clase <code>Server</code> que inicializa la aplicación Express, define las rutas y define los métodos HTTP que se utilizarán en el servidor. En <code>this.app.use(express.json())</code> se define para que el servidor utilice JSON como formato de intercambio de datos.</p>
<p>En <code>this.defineGet()</code>, <code>this.definePost()</code>, <code>this.defineDelete()</code> y <code>this.definePatch()</code> se definen los métodos HTTP GET, POST, DELETE y PATCH, respectivamente. En <code>this.app.all(&#39;*&#39;, (_, res) =&gt; { res.status(501).send() })</code> se define que si se hace una petición a una ruta que no existe, se devuelva un código de estado 501.</p>
<pre><code class="language-TypeScript"><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">defineGet</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">route</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">routes</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">app</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-6">route</span><span class="hl-1">, (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">          .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Get request completed&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">          .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error in get request: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">definePost</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">route</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">routes</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">app</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-6">route</span><span class="hl-1">, (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">          .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Post request completed&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">          .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error in post request: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">defineDelete</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">route</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">routes</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">app</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-6">route</span><span class="hl-1">, (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">          .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Delete request completed&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">          .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error in delete request: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">definePatch</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">route</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">routes</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">app</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-6">route</span><span class="hl-1">, (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">          .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Patch request completed&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">          .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error in patch request: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>Ahora se han definido los cuatro métodos: <code>defineGet()</code>, <code>definePost()</code>, <code>defineDelete()</code> y <code>definePatch()</code>. Cada uno de ellos recorre la constante <code>routes</code> y define un método HTTP para cada ruta. Por ejemplo, <code>this.app.get(route, (req, res) =&gt; { this.get(req, res) ... })</code> define un método HTTP GET para cada ruta. En cada método HTTP se llama a un método privado que se encarga de realizar la operación correspondiente. Cada unno de estos métodos tiene exactamente la misma estructura, solo que cambia el método HTTP que se define.</p>
<pre><code class="language-TypeScript"><span class="hl-1">  </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-7">start</span><span class="hl-1">(</span><span class="hl-6">port</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1"> | </span><span class="hl-6">string</span><span class="hl-1">): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">server</span><span class="hl-1"> = </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">app</span><span class="hl-1">.</span><span class="hl-7">listen</span><span class="hl-1">(</span><span class="hl-6">port</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">`Server listening on port </span><span class="hl-2">${</span><span class="hl-6">port</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-7">stop</span><span class="hl-1">(): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">disconnect</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">server</span><span class="hl-1">.</span><span class="hl-7">close</span><span class="hl-1">()</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>Se inicializa el servidor HTTP en el puerto especificado y se muestra un mensaje por consola indicando que el servidor se ha iniciado. Se define un método <code>stop()</code> que se encarga de cerrar el servidor y desconectar la base de datos.</p>
<pre><code class="language-TypeScript"><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">get</span><span class="hl-1"> = </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Request</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">      .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Connected to database &#39;</span><span class="hl-1"> + </span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">model</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-5">&#39;?&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">          </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">substring</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-5">&#39;?&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">        </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-6">url</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">TrackModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">UserModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">GroupModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">ChallengeModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">searchResult</span><span class="hl-1">(</span><span class="hl-6">result</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1">)</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">name:</span><span class="hl-1"> </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() })</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">searchResult</span><span class="hl-1">(</span><span class="hl-6">result</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1">)</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">find</span><span class="hl-1">()</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">searchResult</span><span class="hl-1">(</span><span class="hl-6">result</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Bad parameters&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error connecting to database: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>Este método se encarga de realizar una operación GET en la base de datos. En primer lugar, se conecta a la base de datos. A continuación, se comprueba la ruta a la que se ha hecho la petición y se asigna el modelo correspondiente a la variable <code>model</code>.</p>
<p>Si la ruta es <code>/tracks</code>, se asigna el modelo <code>TrackModel</code>, si la ruta es <code>/users</code>, se asigna el modelo <code>UserModel</code>, si la ruta es <code>/groups</code>, se asigna el modelo <code>GroupModel</code> y si la ruta es <code>/challenges</code>, se asigna el modelo <code>ChallengeModel</code>.</p>
<p>Si la ruta no es ninguna de las anteriores, se devuelve un código de estado 400. Si la ruta es <code>/tracks/:id</code>, se busca un documento en la base de datos con el identificador especificado en la ruta. Si la ruta es <code>/tracks?name=...</code>, se busca un documento en la base de datos con el nombre especificado en la ruta. Si la ruta es <code>/tracks</code>, se buscan todos los documentos de la base de datos. En cada caso, se llama al método <code>searchResult()</code> que se encarga de devolver el resultado de la búsqueda.</p>
<pre><code class="language-TypeScript"><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">post</span><span class="hl-1"> = </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Request</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">      .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Connected to database &#39;</span><span class="hl-1"> + </span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">document</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">url</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">body</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-5">&#39;?&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">          </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Bad parameters&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">        </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-6">url</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-6">document</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">TrackModel</span><span class="hl-1">(</span><span class="hl-6">body</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">createReferencesToTrack</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-6">document</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UserModel</span><span class="hl-1">(</span><span class="hl-6">body</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">createReferencesToUser</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-6">body</span><span class="hl-1"> = </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">updateRanking</span><span class="hl-1">(</span><span class="hl-6">body</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-6">document</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">GroupModel</span><span class="hl-1">(</span><span class="hl-6">body</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">createReferencesToGroup</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-6">document</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">ChallengeModel</span><span class="hl-1">(</span><span class="hl-6">body</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">createReferencesToChallenge</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><br/><span class="hl-1">            </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Bad parameters&#39;</span><span class="hl-1">, </span><span class="hl-6">error:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">document</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-6">document</span><br/><span class="hl-1">            .</span><span class="hl-7">save</span><span class="hl-1">()</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">201</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Created&#39;</span><span class="hl-1">, </span><span class="hl-6">result:</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Bad parameters&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error connecting to database: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">createReferencesToTrack</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">: </span><span class="hl-6">any</span><span class="hl-1">): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">users</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">users</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1"> !== </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;User not found&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">tracks:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">multi:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">createReferencesToUser</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">: </span><span class="hl-6">any</span><span class="hl-1">): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">TrackModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">tracks</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">tracks</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">tracks</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">tracks</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">tracks</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1"> !== </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">tracks</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;Track not found&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">TrackModel</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">tracks</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">multi:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-6">ChallengeModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">challenges</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">(</span><br/><span class="hl-1">      (</span><span class="hl-6">challenges</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><br/><span class="hl-1">          </span><span class="hl-6">challenges</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">          </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">challenges</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">          </span><span class="hl-6">challenges</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1"> !== </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">challenges</span><span class="hl-1">.</span><span class="hl-6">length</span><br/><span class="hl-1">        )</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;Challenge not found&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-6">ChallengeModel</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">challenges</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">multi:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-6">GroupModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">groups</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">groups</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">groups</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">groups</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">groups</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1"> !== </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">groups</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;Group not found&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">GroupModel</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">groups</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">multi:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">createReferencesToGroup</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">: </span><span class="hl-6">any</span><span class="hl-1">): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">users</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">users</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1"> !== </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;User not found&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">groups:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">multi:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">createReferencesToChallenge</span><span class="hl-1">(</span><span class="hl-6">document</span><span class="hl-1">: </span><span class="hl-6">any</span><span class="hl-1">): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">users</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">users</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1"> !== </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;User not found&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">challenges:</span><span class="hl-1"> </span><span class="hl-6">document</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> } },</span><br/><span class="hl-1">      { </span><span class="hl-6">multi:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>Este método se encarga de realizar una operación POST en la base de datos. En primer lugar, se conecta a la base de datos. A continuación, se comprueba la ruta a la que se ha hecho la petición y se asigna el modelo correspondiente a la variable <code>model</code>.</p>
<p>Si la ruta es <code>/tracks</code>, se asigna el modelo <code>TrackModel</code>, si la ruta es <code>/users</code>, se asigna el modelo <code>UserModel</code>, si la ruta es <code>/groups</code>, se asigna el modelo <code>GroupModel</code> y si la ruta es <code>/challenges</code>, se asigna el modelo <code>ChallengeModel</code>. Si la ruta no es ninguna de las anteriores, se devuelve un código de estado 400. Si la ruta es <code>/tracks</code>, se crea un documento de tipo <code>TrackModel</code> con el cuerpo de la petición y se llama al método <code>createReferencesToTrack()</code> que se encarga de crear las referencias a los usuarios que han realizado la actividad física.</p>
<p>Si la ruta es <code>/users</code>, se crea un documento de tipo <code>UserModel</code> con el cuerpo de la petición y se llama al método <code>createReferencesToUser()</code> que se encarga de crear las referencias a los grupos, desafíos y pistas en los que ha participado el usuario. Si la ruta es <code>/groups</code>, se crea un documento de tipo <code>GroupModel</code> con el cuerpo de la petición y se llama al método <code>createReferencesToGroup()</code> que se encarga de crear las referencias a los usuarios que pertenecen al grupo.</p>
<p>Si la ruta es <code>/challenges</code>, se crea un documento de tipo <code>ChallengeModel</code> con el cuerpo de la petición y se llama al método <code>createReferencesToChallenge()</code> que se encarga de crear las referencias a los usuarios que participan en el desafío. En cada caso, se llama al método <code>save()</code> que se encarga de guardar el documento en la base de datos.</p>
<pre><code class="language-TypeScript"><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-2">delete</span><span class="hl-1"> = </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Request</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">      .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Connected to database &#39;</span><span class="hl-1"> + </span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">model</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-5">&#39;?&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">          </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">substring</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-5">&#39;?&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">        </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-6">url</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">TrackModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">UserModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">GroupModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">ChallengeModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">deleteReferencesFromUser</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Deleted&#39;</span><span class="hl-1">, </span><span class="hl-6">result:</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">findOne</span><span class="hl-1">({ </span><span class="hl-6">name:</span><span class="hl-1"> </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">result</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1"> === </span><span class="hl-6">UserModel</span><span class="hl-1">)</span><br/><span class="hl-1">                  </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">deleteReferencesFromUser</span><span class="hl-1">(</span><span class="hl-6">result</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">deleteOne</span><span class="hl-1">({ </span><span class="hl-6">name:</span><span class="hl-1"> </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">result</span><span class="hl-1">.</span><span class="hl-6">deletedCount</span><span class="hl-1"> === </span><span class="hl-8">0</span><span class="hl-1">)</span><br/><span class="hl-1">                </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Not found&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">              </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Deleted&#39;</span><span class="hl-1">, </span><span class="hl-6">result:</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Bad parameters&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error connecting to database: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">deleteReferencesFromUser</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">TrackModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">users:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> [</span><span class="hl-6">id</span><span class="hl-1">] } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">tracks</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">tracks</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-6">track</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">track</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">          ...</span><span class="hl-6">track</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">filter</span><span class="hl-1">((</span><span class="hl-6">user</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> !== </span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">        )</span><br/><span class="hl-1">        </span><span class="hl-6">track</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">()</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">users:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> [</span><span class="hl-6">id</span><span class="hl-1">] } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">users</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-6">user</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">          ...</span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">filter</span><span class="hl-1">((</span><span class="hl-6">friend</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-6">friend</span><span class="hl-1"> !== </span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">        )</span><br/><span class="hl-1">        </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">()</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">GroupModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">users:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> [</span><span class="hl-6">id</span><span class="hl-1">] } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">groups</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">groups</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-6">group</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">group</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">          ...</span><span class="hl-6">group</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">filter</span><span class="hl-1">((</span><span class="hl-6">member</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-6">member</span><span class="hl-1"> !== </span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">        )</span><br/><span class="hl-1">        </span><span class="hl-6">group</span><span class="hl-1">.</span><span class="hl-6">ranking</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-6">group</span><span class="hl-1">.</span><span class="hl-6">ranking</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">), </span><span class="hl-8">1</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-6">group</span><span class="hl-1">.</span><span class="hl-6">records</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-6">record</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-6">record</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">splice</span><span class="hl-1">(</span><span class="hl-6">record</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">), </span><span class="hl-8">1</span><span class="hl-1">)</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">ChallengeModel</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">({ </span><span class="hl-6">users:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> [</span><span class="hl-6">id</span><span class="hl-1">] } }).</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">challenges</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">challenges</span><span class="hl-1">.</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-6">challenge</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">challenge</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">          ...</span><span class="hl-6">challenge</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-7">filter</span><span class="hl-1">((</span><span class="hl-6">user</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> !== </span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">        )</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>Este método se encarga de realizar una operación DELETE en la base de datos. En primer lugar, se conecta a la base de datos. A continuación, se comprueba la ruta a la que se ha hecho la petición y se asigna el modelo correspondiente a la variable <code>model</code>.</p>
<p>Si la ruta es <code>/tracks</code>, se asigna el modelo <code>TrackModel</code>, si la ruta es <code>/users</code>, se asigna el modelo <code>UserModel</code>, si la ruta es <code>/groups</code>, se asigna el modelo <code>GroupModel</code> y si la ruta es <code>/challenges</code>, se asigna el modelo <code>ChallengeModel</code>.</p>
<p>Si la ruta no es ninguna de las anteriores, se devuelve un código de estado 400. Si la ruta es <code>/tracks/:id</code>, se busca un documento en la base de datos con el identificador especificado en la ruta. Si la ruta es <code>/tracks?name=...</code>, se busca un documento en la base de datos con el nombre especificado en la ruta. Si la ruta es <code>/tracks</code>, se buscan todos los documentos de la base de datos.</p>
<p>En cada caso, se llama al método <code>searchResult()</code> que se encarga de devolver el resultado de la búsqueda. El método privado <code>deleteReferencesFromUser</code> se encarga de eliminar las referencias a un usuario que se ha eliminado de la base de datos. Obtiene los documentos de tipo <code>TrackModel</code>, <code>UserModel</code>, <code>GroupModel</code> y <code>ChallengeModel</code> que contienen al usuario y elimina las referencias.</p>
<pre><code class="language-TypeScript"><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">patch</span><span class="hl-1"> = </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Request</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">: </span><span class="hl-3">express</span><span class="hl-1">.</span><span class="hl-3">Response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">      .</span><span class="hl-7">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Connected to database &#39;</span><span class="hl-1"> + </span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">model</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">body</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-5">&#39;?&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">          </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">substring</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">url</span><span class="hl-1">.</span><span class="hl-7">indexOf</span><span class="hl-1">(</span><span class="hl-5">&#39;?&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">        </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-6">url</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">TrackModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">UserModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">GroupModel</span><br/><span class="hl-1">            </span><span class="hl-6">body</span><span class="hl-1"> = </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">updateRanking</span><span class="hl-1">(</span><span class="hl-6">body</span><span class="hl-1">)</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-6">ChallengeModel</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">          </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-0">break</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">)</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">, </span><span class="hl-6">body</span><span class="hl-1">, {</span><br/><span class="hl-1">              </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">searchResult</span><span class="hl-1">(</span><span class="hl-6">result</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">model</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1">)</span><br/><span class="hl-1">          </span><span class="hl-6">model</span><br/><span class="hl-1">            .</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-6">name:</span><span class="hl-1"> </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() }, </span><span class="hl-6">body</span><span class="hl-1">, {</span><br/><span class="hl-1">              </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">then</span><span class="hl-1">((</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-7">searchResult</span><span class="hl-1">(</span><span class="hl-6">result</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">)</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-6">err</span><span class="hl-1"> })</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Bad parameters&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-7">catch</span><span class="hl-1">((</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Error connecting to database: &#39;</span><span class="hl-1"> + </span><span class="hl-6">err</span><span class="hl-1">)</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>Este método se encarga de realizar una operación PATCH en la base de datos. En primer lugar, se conecta a la base de datos. A continuación, se comprueba la ruta a la que se ha hecho la petición y se asigna el modelo correspondiente a la variable <code>model</code>.</p>
<p>Si la ruta es <code>/tracks</code>, se asigna el modelo <code>TrackModel</code>, si la ruta es <code>/users</code>, se asigna el modelo <code>UserModel</code>, si la ruta es <code>/groups</code>, se asigna el modelo <code>GroupModel</code> y si la ruta es <code>/challenges</code>, se asigna el modelo <code>ChallengeModel</code>.</p>
<p>Si la ruta no es ninguna de las anteriores, se devuelve un código de estado 400. Si la ruta es <code>/tracks/:id</code>, se busca un documento en la base de datos con el identificador especificado en la ruta. Si la ruta es <code>/tracks?name=...</code>, se busca un documento en la base de datos con el nombre especificado en la ruta. Si la ruta es <code>/tracks</code>, se buscan todos los documentos de la base de datos.</p>
<p>En cada caso, se llama al método <code>searchResult()</code> que se encarga de devolver el resultado de la búsqueda. Si la ruta es <code>/groups</code>, se llama al método <code>updateRanking()</code> que se encarga de actualizar el ranking del grupo.</p>
<pre><code class="language-TypeScript"><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">searchResult</span><span class="hl-1">(</span><span class="hl-6">result</span><span class="hl-1">: </span><span class="hl-6">any</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">: </span><span class="hl-6">express</span><span class="hl-1">.</span><span class="hl-6">Response</span><span class="hl-1">): </span><span class="hl-2">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-6">result</span><span class="hl-1">) </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">404</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Not found&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">    </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">).</span><span class="hl-7">json</span><span class="hl-1">({ </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;Found&#39;</span><span class="hl-1">, </span><span class="hl-6">result:</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> })</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>El método privado <code>searchResult()</code> se encarga de devolver el resultado de la búsqueda. Si el resultado es nulo, se devuelve un código de estado 404 y mostrando un mensaje de que no se ha encontrado. Si el resultado no es nulo, se devuelve un código de estado 200, comprobando que se ha encontrado.</p>
<pre><code class="language-TypeScript"><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-7">updateRanking</span><span class="hl-1">(</span><span class="hl-6">body</span><span class="hl-1">: </span><span class="hl-6">any</span><span class="hl-1">): </span><span class="hl-6">any</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> { </span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">name</span><span class="hl-1">, </span><span class="hl-4">users</span><span class="hl-1"> } = </span><span class="hl-6">body</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">group</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Group</span><span class="hl-1">(</span><span class="hl-6">id</span><span class="hl-1">, </span><span class="hl-6">name</span><span class="hl-1">, ...</span><span class="hl-6">users</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">record</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">body</span><span class="hl-1">.</span><span class="hl-6">records</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-6">record</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">(...</span><span class="hl-6">record</span><span class="hl-1">.</span><span class="hl-6">users</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">group</span><span class="hl-1">.</span><span class="hl-6">records</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">UniqueList</span><span class="hl-1">&lt;</span><span class="hl-3">ExtendedEntry</span><span class="hl-1">&gt;(...</span><span class="hl-6">body</span><span class="hl-1">.</span><span class="hl-6">records</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">ranking</span><span class="hl-1"> = </span><span class="hl-6">group</span><span class="hl-1">.</span><span class="hl-6">ranking</span><span class="hl-1">.</span><span class="hl-6">values</span><br/><span class="hl-1">    </span><span class="hl-6">body</span><span class="hl-1">.</span><span class="hl-6">ranking</span><span class="hl-1"> = </span><span class="hl-6">ranking</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">body</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#maints" id="maints" style="color: inherit; text-decoration: none;">
  <h3>main.ts</h3>
</a>

<a href="#código" id="código" style="color: inherit; text-decoration: none;">
  <h4>Código</h4>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Server</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&#39;./Server.js&#39;</span><br/><br/><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-7">main</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Server</span><span class="hl-1">().</span><span class="hl-7">start</span><span class="hl-1">(</span><span class="hl-8">3000</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">main</span><span class="hl-1">()</span>
</code></pre>
<p>Este código define una función <code>main()</code> que crea una instancia de la clase <code>Server</code> y llama al método <code>start()</code> con el argumento 3000. Luego, la función <code>main()</code> se llama para iniciar el servidor.</p>
<p>La clase <code>Server</code> se utiliza para crear un servidor web utilizando Node.js y Express. El método <code>start()</code> se utiliza para iniciar el servidor en un puerto específico. En este caso, el servidor se iniciará en el puerto 3000.</p>
<p>La función <code>main()</code> es la función principal del programa y se llama para iniciar el servidor. Al llamar a la función <code>main()</code>, se crea una instancia de la clase <code>Server</code> y se inicia el servidor en el puerto 3000.</p>

<a href="#pruebas-y-cubrimiento" id="pruebas-y-cubrimiento" style="color: inherit; text-decoration: none;">
  <h2>Pruebas y cubrimiento</h2>
</a>
<p>Han sido realiazadas pruebas con <code>mocha</code> y <code>chai</code>, con el fin de verificar el correcto funcionamiento de todos y cada uno de los ficheros del proyecto. A continuación, a través del fichero <code>Destravate.spec.ts</code>, se muestra la salida por pantalla tanto de las pruebas como del cubrimiento del código:</p>
<pre><code class="language-console"><span class="hl-1">[~/Destravate(main)]</span><span class="hl-6">$npm</span><span class="hl-1"> run test</span><br/><br/><span class="hl-1">&gt; prct12@1.0.0 test</span><br/><span class="hl-1">&gt; env-cmd -f ./config/test.env mocha --exit</span><br/><br/><span class="hl-1">(</span><span class="hl-7">node:108429</span><span class="hl-1">) ExperimentalWarning: Custom ESM Loaders is an experimental feature and might change at any </span><span class="hl-2">time</span><br/><span class="hl-1">(</span><span class="hl-7">Use</span><span class="hl-1"> </span><span class="hl-5">`</span><span class="hl-7">node</span><span class="hl-5"> </span><span class="hl-2">--trace-warnings</span><span class="hl-5"> ...`</span><span class="hl-1"> </span><span class="hl-7">to</span><span class="hl-1"> </span><span class="hl-5">show</span><span class="hl-1"> </span><span class="hl-5">where</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">warning</span><span class="hl-1"> </span><span class="hl-5">was</span><span class="hl-1"> </span><span class="hl-5">created</span><span class="hl-1">)</span><br/><br/><br/><span class="hl-7">Server</span><span class="hl-1"> </span><span class="hl-5">listening</span><span class="hl-1"> </span><span class="hl-5">on</span><span class="hl-1"> </span><span class="hl-5">port</span><span class="hl-1"> </span><span class="hl-8">3000</span><br/><span class="hl-1">  </span><span class="hl-7">Destravate</span><span class="hl-1"> </span><span class="hl-5">app</span><span class="hl-1"> </span><span class="hl-5">tests</span><br/><span class="hl-1">    </span><span class="hl-7">Track</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-5">tests</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">an</span><span class="hl-1"> </span><span class="hl-5">id</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">name</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">start</span><span class="hl-1"> </span><span class="hl-5">and</span><span class="hl-1"> </span><span class="hl-5">end</span><span class="hl-1"> </span><span class="hl-5">points,</span><span class="hl-1"> </span><span class="hl-5">and</span><span class="hl-1"> </span><span class="hl-5">both</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">Coordinates</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">distance</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">slope</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">users</span><span class="hl-1"> </span><span class="hl-5">that</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">done</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">track</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">an</span><span class="hl-1"> </span><span class="hl-5">activity</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Track</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">score</span><br/><span class="hl-1">    </span><span class="hl-7">User</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-5">tests</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">an</span><span class="hl-1"> </span><span class="hl-5">id</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">name</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">an</span><span class="hl-1"> </span><span class="hl-5">sport</span><span class="hl-1"> </span><span class="hl-5">activity</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">groups</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-5">which</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">user</span><span class="hl-1"> </span><span class="hl-5">is</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">groups</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">groups</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">stats</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">reset</span><span class="hl-1"> </span><span class="hl-5">stats</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">favorite</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">favorite</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">favorite</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">active</span><span class="hl-1"> </span><span class="hl-5">challenges</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">active</span><span class="hl-1"> </span><span class="hl-5">challenges</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">active</span><span class="hl-1"> </span><span class="hl-5">challenges</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">record</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">tracks</span><span class="hl-1"> </span><span class="hl-5">done</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">records</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">know</span><span class="hl-1"> </span><span class="hl-5">if</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">friend/group/favorite/challenge/record</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">when</span><span class="hl-1"> </span><span class="hl-5">adding</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">know</span><span class="hl-1"> </span><span class="hl-5">if</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">friend/group/favorite/challenge/record</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> </span><span class="hl-5">not</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">when</span><span class="hl-1"> </span><span class="hl-5">removing</span><br/><span class="hl-1">    </span><span class="hl-7">Group</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-5">tests</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">an</span><span class="hl-1"> </span><span class="hl-5">id</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">name</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">stats</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">reset</span><span class="hl-1"> </span><span class="hl-5">stats</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">favorite</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">favorite</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">favorite</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">record</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">tracks</span><span class="hl-1"> </span><span class="hl-5">done</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">records</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">know</span><span class="hl-1"> </span><span class="hl-5">if</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">user/favorite/record</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">when</span><span class="hl-1"> </span><span class="hl-5">adding</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">know</span><span class="hl-1"> </span><span class="hl-5">if</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">user/favorite/record</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> </span><span class="hl-5">not</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">when</span><span class="hl-1"> </span><span class="hl-5">removing</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Group</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">ranking</span><br/><span class="hl-1">    </span><span class="hl-7">Challenge</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-5">tests</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">an</span><span class="hl-1"> </span><span class="hl-5">id</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">name</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">an</span><span class="hl-1"> </span><span class="hl-5">activity</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">tracks</span><span class="hl-1"> </span><span class="hl-5">that</span><span class="hl-1"> </span><span class="hl-5">are</span><span class="hl-1"> </span><span class="hl-5">part</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">challenge</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">tracks</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">have</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">users</span><span class="hl-1"> </span><span class="hl-5">that</span><span class="hl-1"> </span><span class="hl-5">are</span><span class="hl-1"> </span><span class="hl-5">part</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">challenge</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">remove</span><span class="hl-1"> </span><span class="hl-5">users</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">know</span><span class="hl-1"> </span><span class="hl-5">if</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">user/track</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">when</span><span class="hl-1"> </span><span class="hl-5">adding</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Challenge</span><span class="hl-1"> </span><span class="hl-5">Objects</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">know</span><span class="hl-1"> </span><span class="hl-5">if</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">user/track</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> </span><span class="hl-5">not</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">list</span><span class="hl-1"> </span><span class="hl-5">when</span><span class="hl-1"> </span><span class="hl-5">removing</span><br/><span class="hl-1">    </span><span class="hl-7">Server</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-5">tests</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Servers</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">make</span><span class="hl-1"> </span><span class="hl-5">POST</span><span class="hl-1"> </span><span class="hl-5">requests</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">API</span><span class="hl-1"> (140ms)</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Servers</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">make</span><span class="hl-1"> </span><span class="hl-5">GET</span><span class="hl-1"> </span><span class="hl-5">requests</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">API</span><span class="hl-1"> (49ms)</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Servers</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">make</span><span class="hl-1"> </span><span class="hl-5">PATCH</span><span class="hl-1"> </span><span class="hl-5">requests</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">API</span><br/><span class="hl-1">      </span><span class="hl-7">✔</span><span class="hl-1"> </span><span class="hl-5">Servers</span><span class="hl-1"> </span><span class="hl-5">should</span><span class="hl-1"> </span><span class="hl-5">be</span><span class="hl-1"> </span><span class="hl-5">able</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">make</span><span class="hl-1"> </span><span class="hl-5">DELETE</span><span class="hl-1"> </span><span class="hl-5">requests</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> </span><span class="hl-5">the</span><span class="hl-1"> </span><span class="hl-5">API</span><span class="hl-1"> (46ms)</span><br/><br/><br/><span class="hl-1">  </span><span class="hl-7">59</span><span class="hl-1"> </span><span class="hl-5">passing</span><span class="hl-1"> (455ms)</span>
</code></pre>
<p>También podemos comprobar el cubrimiento de código con Istanbul y Coveralls:</p>
<pre><code class="language-console"><span class="hl-7">---------------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">----------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">-------------------------------------------------------------------</span><br/><span class="hl-7">File</span><span class="hl-1">           | </span><span class="hl-7">%</span><span class="hl-1"> </span><span class="hl-5">Stmts</span><span class="hl-1"> | </span><span class="hl-7">%</span><span class="hl-1"> </span><span class="hl-5">Branch</span><span class="hl-1"> | </span><span class="hl-7">%</span><span class="hl-1"> </span><span class="hl-5">Funcs</span><span class="hl-1"> | </span><span class="hl-7">%</span><span class="hl-1"> </span><span class="hl-5">Lines</span><span class="hl-1"> | </span><span class="hl-7">Uncovered</span><span class="hl-1"> </span><span class="hl-5">Line</span><span class="hl-1"> </span><span class="hl-9">#s</span><br/><span class="hl-7">---------------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">----------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">-------------------------------------------------------------------</span><br/><span class="hl-7">All</span><span class="hl-1"> </span><span class="hl-5">files</span><span class="hl-1">      |   </span><span class="hl-7">92.63</span><span class="hl-1"> |    </span><span class="hl-7">82.44</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |   </span><span class="hl-7">92.63</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">Activity.ts</span><span class="hl-1">   |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">Challenge.ts</span><span class="hl-1">  |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">Group.ts</span><span class="hl-1">      |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">Models.ts</span><span class="hl-1">     |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">Server.ts</span><span class="hl-1">     |   </span><span class="hl-7">84.04</span><span class="hl-1"> |       </span><span class="hl-7">77</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |   </span><span class="hl-7">84.04</span><span class="hl-1"> | </span><span class="hl-7">..</span><span class="hl-1">.99-426,429,448-451,456-462,467-469,504,516,518-530,533,557-563</span><br/><span class="hl-1"> </span><span class="hl-7">Stats.ts</span><span class="hl-1">      |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">Track.ts</span><span class="hl-1">      |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">UniqueList.ts</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-1"> </span><span class="hl-7">User.ts</span><span class="hl-1">       |     </span><span class="hl-7">100</span><span class="hl-1"> |      </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |     </span><span class="hl-7">100</span><span class="hl-1"> |</span><br/><span class="hl-7">---------------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">----------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">---------</span><span class="hl-1">|</span><span class="hl-7">-------------------------------------------------------------------</span>
</code></pre>
<p>Se ha procurado cubrir el mayor rango de código posible, pero hay ciertas partes del servidor que nos ha resultado laborioso y sobretodo que iba a llevar mucho tiempo, por lo que hemos optado por optimizar el tiempo y centrarnos en otras partes del servidor.</p>
<p>Asimismo cabe destacar que para realizar las pruebas se ha utilizado el método <code>request</code> de la librería <code>supertest</code> que nos permite realizar peticiones HTTP a nuestro servidor y comprobar que la respuesta es la esperada. Asimismo y como vimos en clases, tenemos que utilizar hooks para poder realizar las pruebas de forma asíncrona, ya que por ejemplo tenemos que asegurarnos de que la base de datos de <code>mongodb</code> se encuentre vacía a la hora de realizar las pruebas, ya que de otra manera pordría afectar a las mismas.</p>
<pre><code class="language-TypeScript"><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">server</span><span class="hl-1">: </span><span class="hl-3">Server</span><br/><span class="hl-7">before</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">  </span><span class="hl-6">server</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Server</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">server</span><span class="hl-1">.</span><span class="hl-7">start</span><span class="hl-1">(</span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">PORT</span><span class="hl-1"> || </span><span class="hl-8">3000</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-6">env</span><span class="hl-1">.</span><span class="hl-4">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">TrackModel</span><span class="hl-1">.</span><span class="hl-7">deleteMany</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">UserModel</span><span class="hl-1">.</span><span class="hl-7">deleteMany</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">GroupModel</span><span class="hl-1">.</span><span class="hl-7">deleteMany</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">ChallengeModel</span><span class="hl-1">.</span><span class="hl-7">deleteMany</span><span class="hl-1">()</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-7">after</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">server</span><span class="hl-1">.</span><span class="hl-7">stop</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">disconnect</span><span class="hl-1">()</span><br/><span class="hl-1">})</span>
</code></pre>

<a href="#despliegue-en-cyclic" id="despliegue-en-cyclic" style="color: inherit; text-decoration: none;">
  <h2>Despliegue en Cyclic</h2>
</a>
<p>Como se nos había solicitado, la API REST se encuentra desplegada en cyclic, en cada una de las cuentas personales de Github de los integrantes del equipo. En el vídeo entregado en el campus virtual procederemos a hacer pruebas en este entorno.</p>

<a href="#conclusión" id="conclusión" style="color: inherit; text-decoration: none;">
  <h2>Conclusión</h2>
</a>
<p>Las API RESTS son una herramienta muy útil para poder comunicar diferentes aplicaciones entre sí, ya que nos permite hacer solicitudes HTTP a través de cualquier cliente como <code>Thunder Client</code> o <code>Postman</code> y obtener una respuesta en formato JSON. Asimismo, el despliegue de estas API RESTS en entornos como <code>Cyclic</code> nos permite tener un servidor en la nube que esté disponible las 24 horas del día, los 7 días de la semana, y que pueda ser accedido desde cualquier parte del mundo, sin necesidad de tener una base de datos local o un servidor local.</p>
<p>A lo largo del proyecto hemos afrontado varias adversidades y problemas sobretodo en las solicitudes al servidor pero hemos sido capaces de solventarlos y aprender de ellos.</p>

<a href="#referencias" id="referencias" style="color: inherit; text-decoration: none;">
  <h2>Referencias</h2>
</a>
<ul>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/prct12-destravate-api/">Guión de la práctica 12.</a></li>
<li><a href="https://www.oreilly.com/library/view/essential-typescript-4/9781484270110/html/Part_1.xhtml">Adam Freeman - Essential TypeScript 4: From Beginner to ProURL</a></li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">prct12</a>
<ul>
<li class="tsd-kind-module"><a href="modules/Activity.html">Activity</a></li>
<li class="tsd-kind-module"><a href="modules/Challenge.html">Challenge</a></li>
<li class="tsd-kind-module"><a href="modules/Coordinate.html">Coordinate</a></li>
<li class="tsd-kind-module"><a href="modules/Entry.html">Entry</a></li>
<li class="tsd-kind-module"><a href="modules/Group.html">Group</a></li>
<li class="tsd-kind-module"><a href="modules/Models.html">Models</a></li>
<li class="tsd-kind-module"><a href="modules/Server.html">Server</a></li>
<li class="tsd-kind-module"><a href="modules/Stats.html">Stats</a></li>
<li class="tsd-kind-module"><a href="modules/Track.html">Track</a></li>
<li class="tsd-kind-module"><a href="modules/UniqueList.html">Unique<wbr/>List</a></li>
<li class="tsd-kind-module"><a href="modules/User.html">User</a></li>
<li class="tsd-kind-module"><a href="modules/main.html">main</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>